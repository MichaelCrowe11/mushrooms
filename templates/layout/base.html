<!DOCTYPE html>
<html class="no-js" lang="{{ locale_name }}">
  <head>
    <title>{{ head.title }}</title>
    {{{ resourceHints }}}
    {{{ head.meta_tags }}}
    {{{ head.config }}}
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Premium mushroom cultures, grow kits, and extracts from Southwest Mushrooms. Expert cultivation guidance and high-quality products for mushroom enthusiasts.">
    <meta name="keywords" content="mushroom cultures, grow kits, mushroom extracts, Lion's Mane, Reishi, Cordyceps, mushroom cultivation, Southwest Mushrooms">
    <meta name="author" content="Southwest Mushrooms">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ head.title }}">
    <meta property="og:description" content="Premium mushroom cultures, grow kits, and extracts from Southwest Mushrooms. Expert cultivation guidance and high-quality products.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ settings.secure_base_url }}{{ page_url }}">
    <meta property="og:image" content="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/original/image-manager/southwest-mushrooms-logo-design.png?t=1751756884">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Southwest Mushrooms">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ head.title }}">
    <meta name="twitter:description" content="Premium mushroom cultures, grow kits, and extracts from Southwest Mushrooms.">
    <meta name="twitter:image" content="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/original/image-manager/southwest-mushrooms-logo-design.png?t=1751756884">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#2d5016">
    <meta name="msapplication-TileColor" content="#2d5016">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Southwest Mushrooms">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ settings.secure_base_url }}{{ page_url }}">
    
    {{#block "head"}}{{/block}}

    <link href="{{{ head.favicon }}}" rel="shortcut icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script nonce="{{nonce}}">document.documentElement.className=document.documentElement.className.replace('no-js','js');</script>
    {{> components/common/polyfill-script }}
    <script nonce="{{nonce}}">window.consentManagerTranslations=`{{{langJson 'consent_manager'}}}`;</script>

    {{!-- LazySizes config / async head bundle --}}
    <script nonce="{{nonce}}">window.lazySizesConfig={loadMode:1};</script>
    <script nonce="{{nonce}}" async src="{{cdn 'assets/dist/theme-bundle.head_async.js' resourceHint='preload' as='script'}}"></script>

    {{getFontsCollection font-display='block'}}
    <script nonce="{{nonce}}" async src="{{cdn 'assets/dist/theme-bundle.font.js' resourceHint='preload' as='script'}}"></script>

    {{{stylesheet '/assets/css/theme.css'}}}
    {{{head.scripts}}}

    {{~inject 'zoomSize' theme_settings.zoom_size}}
    {{~inject 'productSize' theme_settings.product_size}}
    {{~inject 'genericError' (lang 'common.generic_error')}}
    {{~inject 'urls' urls}}
    {{~inject 'secureBaseUrl' settings.secure_base_url}}
    {{~inject 'cartId' cart_id}}
    {{~inject 'template' template}}
    {{~inject 'validationDictionaryJSON' (langJson 'validation_messages')}}
    {{~inject 'validationFallbackDictionaryJSON' (langJson 'validation_fallback_messages')}}
    {{~inject 'validationDefaultDictionaryJSON' (langJson 'validation_default_messages')}}
    {{~inject 'carouselArrowAndDotAriaLabel' (lang 'carousel.arrow_and_dot_aria_label')}}
    {{~inject 'carouselActiveDotAriaLabel' (lang 'carousel.active_dot_aria_label')}}
    {{~inject 'carouselContentAnnounceMessage' (lang 'carousel.content_announce_message')}}
    {{~inject 'giftWrappingRemoveMessage' (lang 'cart.gift_wrapping.remove_confirm')}}
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="loading-spinner">
        <img src="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/original/image-manager/southwest-mushrooms-logo-design.png?t=1751756884" 
             alt="Southwest Mushrooms" 
             class="loading-logo">
        <div class="mushroom-spinner"></div>
        <p>Loading Southwest Mushrooms...</p>
      </div>
    </div>

    <!-- Mobile Toggle Button -->
    <button id="sidebar-toggle" class="mobile-toggle" aria-label="Toggle menu">
      <img src="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/original/image-manager/southwest-mushrooms-logo-design.png?t=1751756884" 
           alt="Southwest Mushrooms" 
           class="mobile-logo">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <!-- Fixed Sidebar Navigation -->
    <aside class="sidebar-nav" aria-label="Main navigation">
      <div class="brand">
        <img src="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/original/image-manager/southwest-mushrooms-logo-design.png?t=1751756884" 
             alt="Southwest Mushrooms" 
             class="brand-logo">
      </div>
      
      <!-- Theme Toggle -->
      <div class="theme-toggle">
        <button id="theme-toggle" aria-label="Toggle dark mode" title="Switch between light and dark themes">
          <span class="sun-icon" aria-hidden="true">‚òÄÔ∏è</span>
          <span class="moon-icon" aria-hidden="true">üåô</span>
        </button>
      </div>
      <ul role="menubar">
        <li role="none">
          <a href="/" class="nav-link" role="menuitem" aria-label="Go to homepage">
            <span class="nav-icon" aria-hidden="true">üè†</span>Home
          </a>
        </li>
        <li role="none">
          <a href="/cultures" class="nav-link" role="menuitem" aria-label="Browse mushroom cultures and spores">
            <span class="nav-icon" aria-hidden="true">üß¨</span>Cultures
          </a>
        </li>
        <li role="none">
          <a href="/grow-kits" class="nav-link" role="menuitem" aria-label="View mushroom grow kits and supplies">
            <span class="nav-icon" aria-hidden="true">üå±</span>Grow Kits
          </a>
        </li>
        <li role="none">
          <a href="/tinctures" class="nav-link" role="menuitem" aria-label="Shop mushroom extracts and tinctures">
            <span class="nav-icon" aria-hidden="true">üíß</span>Extracts
          </a>
        </li>
        <li role="none">
          <a href="/videos" class="nav-link" role="menuitem" aria-label="Watch mushroom cultivation videos and tutorials">
            <span class="nav-icon" aria-hidden="true">üé•</span>Videos
          </a>
        </li>
        <li role="none">
          <a href="/blog" class="nav-link" role="menuitem" aria-label="Read mushroom growing articles and guides">
            <span class="nav-icon" aria-hidden="true">üìù</span>Blog
          </a>
        </li>
        <li role="none">
          <a href="/gpt-lab" class="nav-link" role="menuitem" aria-label="Access Crowe AI assistant for mushroom cultivation help">
            <span class="nav-icon" aria-hidden="true">ü§ñ</span>Crowe GPT Lab
          </a>
        </li>
      </ul>
      <div class="avatar-footer">
        <img src="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/320w/image-manager/untitled-design.png?t=1744348936" alt="Crowe Avatar" loading="lazy">
        <p>Powered by Crowe Logic</p>
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span class="status-text">AI Assistant Online</span>
        </div>
      </div>
    </aside>

    <!-- Page Wrapper -->
    <div class="page-wrapper">
      {{> components/common/header }}
      {{> components/common/body }}
      {{> components/common/footer }}
    </div>

    <!-- Scroll to Top Button -->
    <button id="scroll-to-top" class="scroll-to-top" aria-label="Scroll to top">
      <span>‚Üë</span>
    </button>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast">
      <div class="toast-content">
        <img src="https://cdn11.bigcommerce.com/s-qe8ntvzzrw/images/stencil/original/image-manager/southwest-mushrooms-logo-design.png?t=1751756884" 
             alt="Southwest Mushrooms" 
             class="toast-logo">
        <span class="toast-message"></span>
      </div>
    </div>

    <svg data-src="{{cdn 'img/icon-sprite.svg'}}" class="icons-svg-sprite"></svg>

    <!-- Enhanced JavaScript -->
    <script nonce="{{nonce}}">window.__webpack_public_path__="{{cdn 'assets/dist/'}}";</script>
    <script id="theme-bundle-main" nonce="{{nonce}}" async defer src="{{cdn 'assets/dist/theme-bundle.main.js'}}"></script>
    <script nonce="{{nonce}}">
      // Enhanced UI/UX JavaScript
      document.addEventListener('DOMContentLoaded', function() {
        // Remove loading overlay
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) {
          setTimeout(() => {
            loadingOverlay.style.opacity = '0';
            setTimeout(() => loadingOverlay.style.display = 'none', 300);
          }, 500);
        }

        // Sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarNav = document.querySelector('.sidebar-nav');
        
        if (sidebarToggle && sidebarNav) {
          sidebarToggle.addEventListener('click', function() {
            sidebarNav.classList.toggle('open');
            sidebarToggle.classList.toggle('active');
          });

          // Close sidebar when clicking outside on mobile
          document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
              if (!sidebarNav.contains(e.target) && !sidebarToggle.contains(e.target)) {
                sidebarNav.classList.remove('open');
                sidebarToggle.classList.remove('active');
              }
            }
          });
        }

        // Scroll to top functionality
        const scrollToTopBtn = document.getElementById('scroll-to-top');
        if (scrollToTopBtn) {
          window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
              scrollToTopBtn.classList.add('visible');
            } else {
              scrollToTopBtn.classList.remove('visible');
            }
          });

          scrollToTopBtn.addEventListener('click', function() {
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          });
        }

        // Enhanced navigation links
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(function(link) {
          link.addEventListener('mouseenter', function() {
            this.style.transform = 'translateX(8px) scale(1.05)';
          });
          
          link.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0) scale(1)';
          });
        });

        // Intersection Observer for animations
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-in');
            }
          });
        }, observerOptions);

        // Observe elements for animation
        const animateElements = document.querySelectorAll('.product, .video-hero, .youtube-gallery, .card');
        animateElements.forEach(function(el) {
          observer.observe(el);
        });

        // Enhanced form interactions
        const formInputs = document.querySelectorAll('input, textarea, select');
        formInputs.forEach(function(input) {
          input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
          });
          
          input.addEventListener('blur', function() {
            if (!this.value) {
              this.parentElement.classList.remove('focused');
            }
          });
        });

        // Notification system
        window.showNotification = function(message, type = 'info') {
          const toast = document.getElementById('notification-toast');
          const toastMessage = toast.querySelector('.toast-message');
          
          toastMessage.textContent = message;
          toast.className = `notification-toast ${type}`;
          toast.classList.add('show');
          
          setTimeout(() => {
            toast.classList.remove('show');
          }, 3000);
        };

        // Enhanced video interactions with lazy loading
        function initVideoGallery() {
          const videoPlaceholders = document.querySelectorAll('.video-placeholder');
          
          videoPlaceholders.forEach(function(placeholder) {
            const playButton = placeholder.querySelector('.play-button');
            const videoId = placeholder.dataset.videoId;
            const title = placeholder.dataset.title;
            
            if (playButton) {
              playButton.addEventListener('click', function() {
                // Add loading state
                placeholder.classList.add('loading');
                
                // Create iframe
                const iframe = document.createElement('iframe');
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
                iframe.title = title;
                iframe.allowFullscreen = true;
                iframe.loading = 'lazy';
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = '0';
                iframe.style.borderRadius = 'var(--border-radius)';
                
                // Handle iframe load
                iframe.addEventListener('load', function() {
                  placeholder.classList.remove('loading');
                });
                
                // Handle iframe error
                iframe.addEventListener('error', function() {
                  placeholder.classList.remove('loading');
                  placeholder.classList.add('error');
                });
                
                // Replace placeholder content
                placeholder.innerHTML = '';
                placeholder.appendChild(iframe);
              });
            }
          });
        }
        
        // Initialize video gallery
        initVideoGallery();
        
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        
        // Check for saved theme preference or default to light
        const savedTheme = localStorage.getItem('theme') || 'light';
        htmlElement.setAttribute('data-theme', savedTheme);
        
        if (savedTheme === 'dark') {
          themeToggle.classList.add('dark-mode');
        }
        
        themeToggle.addEventListener('click', function() {
          const currentTheme = htmlElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          htmlElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          
          if (newTheme === 'dark') {
            themeToggle.classList.add('dark-mode');
          } else {
            themeToggle.classList.remove('dark-mode');
          }
          
          // Show notification
          if (typeof window.showNotification === 'function') {
            window.showNotification(`Switched to ${newTheme} theme`, 'success');
          }
                });
        
        // GPT Lab iframe functionality (replaces custom chat implementation)
        
        // Initialize GPT Lab iframe functionality
        function initGPTIframe() {
          const gptIframe = document.getElementById('gpt-iframe');
          const gptFallback = document.getElementById('gpt-fallback');
          
          if (gptIframe) {
            // Handle iframe load errors
            gptIframe.addEventListener('error', function() {
              showGPTFallback();
            });
            
            // Handle iframe load timeout
            setTimeout(function() {
              if (gptIframe.style.display !== 'none' && !gptIframe.contentWindow) {
                showGPTFallback();
              }
            }, 10000); // 10 second timeout
            
            // Listen for theme changes and update iframe
            const observer = new MutationObserver(function(mutations) {
              mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                  updateGPTTheme();
                }
              });
            });
            
            observer.observe(document.documentElement, {
              attributes: true,
              attributeFilter: ['data-theme']
            });
            
            // Handle postMessage from iframe
            window.addEventListener('message', function(event) {
              // Verify origin for security
              if (event.origin !== 'https://app.crowelogic.ai') {
                return;
              }
              
              // Handle messages from GPT iframe
              if (event.data.type === 'gpt_ready') {
                console.log('GPT Lab loaded successfully');
              } else if (event.data.type === 'gpt_error') {
                showGPTFallback();
              }
            });
          }
        }
        
        function showGPTFallback() {
          const gptIframe = document.getElementById('gpt-iframe');
          const gptFallback = document.getElementById('gpt-fallback');
          
          if (gptIframe && gptFallback) {
            gptIframe.style.display = 'none';
            gptFallback.style.display = 'flex';
          }
        }
        
        function updateGPTTheme() {
          const gptIframe = document.getElementById('gpt-iframe');
          if (gptIframe && gptIframe.contentWindow) {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const currentSrc = gptIframe.src;
            const newSrc = currentSrc.replace(/[?&]theme=[^&]*/, '') + 
                          (currentSrc.includes('?') ? '&' : '?') + 'theme=' + currentTheme;
            gptIframe.src = newSrc;
          }
        }
        
        // Initialize GPT iframe if on the page
        if (document.getElementById('gpt-iframe')) {
          initGPTIframe();
        }
        
        // Performance optimization: Lazy load images
        const images = document.querySelectorAll('img[data-src]');
        const imageObserver = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.src = img.dataset.src;
              img.classList.remove('lazy');
              imageObserver.unobserve(img);
            }
          });
        });

        images.forEach(function(img) {
          imageObserver.observe(img);
        });

        // Keyboard navigation enhancements
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && window.innerWidth <= 768) {
            sidebarNav.classList.remove('open');
            sidebarToggle.classList.remove('active');
          }
        });

        // Add smooth scrolling to all internal links
        const internalLinks = document.querySelectorAll('a[href^="#"]');
        internalLinks.forEach(function(link) {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });
      });

      // Theme bundle loader
      function onThemeBundleMain(){
        window.stencilBootstrap("{{page_type}}",{{jsContext}}).load();
        if(typeof FormData==='undefined'||!FormData.prototype.keys){
          const s=document.createElement('script');
          s.src='{{cdn 'assets/dist/theme-bundle.polyfill_form_data.js'}}';
          document.body.appendChild(s);
        }
      }
      addEventListener('load',onThemeBundleMain);
    </script>

    {{{footer.scripts}}}
  </body>
</html>
